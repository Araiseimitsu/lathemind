# LatheMind 変更履歴

## v1.0.0 (2025-01-01)

### 初期リリース

- CINCOM L20 NC旋盤自動プログラミングツール
- Gemini API連携による図面解析・プログラム生成機能
- 知識ベース管理機能（サンプル登録・検索）
- HTMX + Tailwind CSS によるWebUI

### 実装機能

1. **NCプログラム生成**
   - 図面画像アップロード
   - 加工条件入力（材質、回転数、送り等）
   - Gemini APIによる図面解析
   - 知識ベースからの類似サンプル検索
   - NCプログラム自動生成

2. **知識ベース**
   - サンプル登録（NCコード + 図面 + メタデータ）
   - サンプル検索（加工タイプ、材質、タグ）
   - インデックス自動管理

3. **API**
   - POST /api/generate - NCプログラム生成
   - POST /api/analyze-drawing - 図面解析
   - GET/POST/DELETE /api/knowledge - 知識ベース管理

---

## v1.1.0 (2026-01-13)

### フェーズ1実装: XLSX工程管理機能

XLSX工程管理表のアップロード・表示・編集機能を実装

#### 新規ファイル

| ファイル | 説明 |
|---------|------|
| `src/services/xlsx_parser.py` | XLSXパーサー（シチズンマシナリー形式） |
| `src/models/process.py` | 工程データモデル |
| `src/api/endpoints/process.py` | 工程管理API |
| `src/templates/process.html` | 工程管理画面 |
| `src/static/js/process.js` | 工程管理JavaScript |

#### 修正ファイル

| ファイル | 変更内容 |
|---------|----------|
| `src/main.py` | `/process` ルート追加 |
| `src/api/router.py` | process.router 登録 |
| `src/templates/base.html` | 工程管理ナビ追加 |
| `requirements.txt` | openpyxl追加 |

#### XLSXパース仕様

**シート名**: `加工工程管理表`

| 項目 | 正面側 | 背面側 |
|------|--------|--------|
| 補正番号 | A列 | S列 |
| ツール番号 | C列 | U列 |
| 工程名 | E列 | W列 |
| 開始行 | 12行目 | 12行目 |
| データ形式 | 1行おき | 1行おき |

#### APIエンドポイント

| メソッド | エンドポイント | 説明 |
|----------|---------------|------|
| GET | /api/process | 工程データ取得 |
| POST | /api/process/upload | XLSXアップロード・パース |
| PUT | /api/process | 工程データ更新 |
| DELETE | /api/process | 工程データクリア |

#### 検証結果

```
✓ サーバー起動: http://127.0.0.1:8000
✓ 工程管理ページ: /process
✓ XLSXパース: 正面側23工程, 背面側1工程（サンプルデータ）
```

---

## 今後の実装計画

### フェーズ2: 図面アップロード・解析機能（再実装）

- 図面アップロードUIの刷新
- Gemini APIによる図面解析
- 抽出情報（形状、寸法、公差）の表示

### フェーズ3: 工程と図面の統合評価

- 工程データと図面情報の照合
- AIによる加工順序の妥当性チェック
- 問題検出・警告表示

### フェーズ4: プログラム生成機能（再実装）

- 知識ベース参照ロジック強化
- 工程データからのNCコード生成
- 生成結果のプレビュー・ダウンロード

### サンプルデータ準備

- 現在: `.docs/samples/L20/1/` に1サンプルのみ
- 必要: 5〜10サンプル（初期）
- 目標: 20〜50サンプル（実運用後）

### サンプルデータ構成

```
.docs/samples/L20/
├── 1/
│   ├── 08121-26312A(L32 1M12).xlsx  # 工程ファイル
│   ├── 08121-26312A.png             # 図面
│   └── 81212631.PRG                # NCプログラム
├── 2/
│   └── ...
```

---

## 未実装機能

| 機能 | 優先度 | ステータス |
|------|--------|----------|
| XLSX工程アップロード・表示 | 高 | ✅ 完了 |
| 工程データ編集 | 高 | ✅ 完了 |
| 図面アップロード（刷新） | 高 | 🔄 フェーズ2 |
| 図面AI解析 | 高 | 🔄 フェーズ2 |
| 工程と図面の統合評価 | 中 | 🔄 フェーズ3 |
| プログラム生成（刷新） | 中 | 🔄 フェーズ4 |
| データベース永続化 | 低 | 📋 保留 |
| ユーザー認証 | 低 | 📋 保留 |
